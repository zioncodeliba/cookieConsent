# מדריך למפתחים - WP Cookie Consent Manager

## סקירה כללית של הפלאגין

פלאגין WordPress לניהול הסכמת עוגיות וסקריפטים. הפלאגין מאפשר לאתרים לציית לדרישות GDPR ו-CCPA על ידי מתן שליטה למשתמשים על העוגיות והסקריפטים שנטענים באתר.

## מבנה הפלאגין

### קבצים ראשיים
- `wp-cookie-consent-manager.php` - קובץ הבסיס של הפלאגין
- `includes/Admin.php` - ניהול ממשק האדמין הראשי
- `includes/Consent.php` - לוגיקת ההסכמה והקטגוריות
- `includes/Dashboard.php` - התחברות לדאשבורד החיצוני

### מבנה תיקיות
```
wp-cookie-consent-manager/
├── assets/                 # קבצי CSS, JS ועיצוב
│   ├── css/                # עיצובים
│   └── js/                 # סקריפטים
├── includes/               # קוד ה-PHP הראשי
│   ├── Admin/              # ממשק האדמין
│   │   ├── Pages/          # דפי האדמין
│   │   └── Ajax/           # טיפול ב-AJAX
│   └── Consent.php         # לוגיקת הסכמה
├── inc/                   # פונקציות עזר
├── tools/                 # כלי פיתוח ובדיקה
└── vendor/               # ספריות חיצוניות
```

## התכונות העיקריות

### 1. בנר הסכמת עוגיות (Frontend)
- **מיקום**: מופיע באתר כאשר הפלאגין פעיל ורישיון תקף
- **4 כפתורים עיקריים**:
  - **קבל הכל** - מאשר את כל העוגיות והסקריפטים
  - **דחה הכל** - דוחה עוגיות לא חיוניות
  - **ניקוי היסטוריה** - מוחק עוגיות קיימות
  - **הגדרות** - פותח חלון בחירה מפורט לפי קטגוריות

### 2. ממשק האדמין
נמצא בתפריט הצדדי תחת "Cookie Consent" עם התת-תפריטים הבאים:

#### א. הגדרות (Settings)
**3 טאבים עיקריים:**

1. **הגדרות כלליות**
   - הגדרת רישיון
   - כותרת ותוכן הבנר
   - הגדרות סינכרון אוטומטי (לא פעיל כרגע)

2. **הגדרות עיצוב**
   - מיקום הבנר
   - צבעי הבנר
   - גודל הבנר
   - תצוגה מקדימה חיה

3. **קטגוריות**
   - רשימת קטגוריות דיפולטיביות
   - אפשרות להוסיף/למחוק קטגוריות
   - **חשוב**: קטגוריית "נחוץ" אינה ניתנת למחיקה או שינוי

#### ב. סינכרון עוגיות וסקריפטים
**2 טאבים:**

1. **עוגיות**
   - כפתור סינכרון
   - טבלת עוגיות נוכחיות
   - היסטוריית סינכרונים

2. **סקריפטים**
   - כפתור סינכרון
   - טבלת סקריפטים נוכחיות
   - היסטוריית סינכרונים

#### ג. ניהול (Management)
- ניהול נתונים ומחיקה ידנית

#### ד. סטטיסטיקות (Statistics)
- נתוני שימוש והסכמות

#### ה. היסטוריית פעילות (History)
- רישום פעילות המשתמשים

### 3. מערכת קטגוריות
- **קטגוריות דיפולטיביות**: נחוץ, פונקציונלי, ביצועים, אנליטיקה, פרסום, אחרים
- **קטגוריית "נחוץ"**: תמיד מופעלת ולא ניתנת לשינוי
- **ניהול דינמי**: קטגוריות נשמרות בטבלת מסד נתונים נפרדת

### 4. מערכת זיהוי אוטומטי
- **זיהוי עוגיות**: סריקה אוטומטית של עוגיות באתר
- **זיהוי סקריפטים**: זיהוי סקריפטים רשומים ב-WordPress
- **מיפוי לקטגוריות**: שיוך אוטומטי לקטגוריות על בסיס היוריסטיקה

## ארכיטקטורה טכנית

### 1. מחלקות עיקריות
- `WP_CCM_Admin` - ניהול האדמין
- `WP_CCM_Consent` - לוגיקת ההסכמה
- `WP_CCM_Admin_Assets` - ניהול קבצי CSS/JS
- `WP_CCM_Admin_Ajax_Consent` - טיפול בבקשות AJAX

### 2. מסד נתונים
- `wp_ck_categories` - טבלת קטגוריות
- `wp_ck_cookies` - טבלת עוגיות
- `wp_ck_scripts` - טבלת סקריפטים
- `wp_options` - הגדרות הפלאגין

### 3. API חיצוני
- התחברות לדאשבורד מרוחק: `WPCCM_DASHBOARD_API_URL`
- מערכת עדכונים אוטומטיים

## פונקציות עזר חשובות

### טקסטים ותרגומים
```php
wpccm_text($key) // מחזיר טקסט מתורגם
```

### קטגוריות
```php
WP_CCM_Consent::categories() // מחזיר מערך קטגוריות
WP_CCM_Consent::get_categories_with_details() // פרטי קטגוריות מלאים
```

### הגדרות
```php
get_option('wpccm_custom_categories') // קטגוריות מותאמות אישית
get_option('wpccm_general_settings') // הגדרות כלליות
```

## נקודות פיתוח עתידיות

1. **סינכרון אוטומטי**: כרגע לא פעיל במלואו
2. **שיפור זיהוי היוריסטי**: עדכון אלגוריתמי הזיהוי
3. **תמיכה בשפות נוספות**: הרחבת מערכת התרגומים
4. **אופטימיזציה**: שיפור ביצועים וזמני טעינה

## הערות פיתוח חשובות

- הפלאגין משתמש במערכת הוקים של WordPress
- כל הקבצים מוגנים מפני גישה ישירה (`!defined('ABSPATH')`)
- השימוש ב-AJAX נרחב לחוויית משתמש מחליקה
- הפלאגין תומך בעדכונים אוטומטיים דרך מערכת PUC

---

**גרסה**: 1.0.32
**מחבר**: code&core
**רישיון**: GPL v2 or later